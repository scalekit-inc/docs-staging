import InstallSDK from '@site/docs/sso/templates/_install-sdk.md';

# Directory Sync Quickstart Guide

<Subtitle>
  Learn how to implement Directory Sync in your B2B application using
  Scalekit.
</Subtitle>

Directory Sync is a crucial feature for B2B applications to help their customers manage their user provisioning and deprovisioning at scale. This capability allows for automatic synchronization of user data between an organization's identity provider (IdP) or directory service and your application. Directory Sync is particularly valuable when dealing with enterprise customers who have a large number of users and require streamlined user lifecycle management. By implementing Directory Sync, you can offer a more attractive solution to enterprise clients, potentially increasing adoption and reducing churn.

/_ TODO: Add SCIM Diagram _/

Implementing Directory Sync in your B2B application involves several steps. Here's a quick overview of the process:

1. **Enable Directory Sync**: As a B2B App Developer, enable Directory Sync for your application in the Scalekit Dashboard. This determines whether Directory Sync configurations will be available to IT Admins.

2. **Configure Webhooks**: As a B2B App Developer, you can configure webhooks to listen for changes in the directory service. This involves setting up the webhook details in the Scalekit Dashboard. For detailed list of events and the corresponding payload, see below:

3. **Configure Directory Sync**: IT Admins can configure Directory Sync for your application via the Admin Portal. This involves setting up the directory sync details in their organization's identity provider (IdP) or directory service.

4. **Create Role Mappings (Optional)**: IT Admins create role mappings between the groups in their organization's identity provider and the roles in your application. This allows for automated role assignment based on group memberships.

5. **Test and Validate**: After configuring Directory Sync, test and validate the integration to ensure that it is working as expected. This involves creating, updating, and deleting users in the identity provider and observing the corresponding actions in your application.

## 1. Environment Setup

Before diving in, make sure you have:

- Access to your Scalekit account and API credentials
- Your app's codebase for implementing and testing changes

### Install the Scalekit SDK

Scalekit offers language-specific SDKs for fast SSO integration. Use the installation instructions below for your technology stack.

<InstallSDK />

### Set up API credentials

Secure your Scalekit API communication by setting up environment variables. You'll need three key pieces of information from your Scalekit Dashboard:

1. **Environment URL**: The base URL for API calls. Each environment (dev, staging, prod) has a unique URL.
2. **Client ID**: Your app's unique identifier for Scalekit communications.
3. **Client Secret**: A private key to authenticate your API requests. For security purposes, this is generated only when you request using the Scalekit Dashboard.

#### Get Your Credentials

1. Log into your Scalekit Dashboard.
2. Select the "Development" environment.
3. Click on "API Config" to view your credentials.

#### Store Credentials Securely

Never hardcode secrets in your app. Use environment variables instead. Here's how to set them in a `.env` file:

<CodeWithHeader title=".env">

```jsx
SCALEKIT_ENVIRONMENT_URL = 'https://b2b-app-dev.scalekit.com';
SCALEKIT_CLIENT_ID = '<CLIENT_ID_FROM_SCALEKIT_DASHBOARD>';
SCALEKIT_CLIENT_SECRET = '<SECRET_FROM_SCALEKIT_DASHBOARD>';
```

</CodeWithHeader>

:::tip

- Never commit your <SimpleCode>.env </SimpleCode> file to version control.
- Rotate your <SimpleCode>secret </SimpleCode>regularly. See the [best practices for managing secrets](/sso/guides/key-concepts/manage-client-secrets).

  :::

Now you're ready to start integrating SSO into your app! Next, we'll cover how to use the SDK to authenticate users.

## 2. Configure Webhooks

For realtime updates about users and their group memership changes, you can configure webhooks to listen for changes in the directory service. This involves setting up the webhook details in the Scalekit Dashboard. For detailed list of directory user related events and the corresponding payload, see [Important Event Types](#important-event-types).

### Important Event Types

| Event Type                                        | Use Case                       | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ------------------------------------------------- | ------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <SimpleCode>scalekit.dir.user.create</SimpleCode> | Automated User Provisioning    | Triggered when a new user is added to the directory                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| <SimpleCode>scalekit.dir.user.update</SimpleCode> | Automated User Profile Updates | Triggered when a user's information is modified in the directory. <br /><br />For detailed list of directory user profile details, see [here](/dir-sync/events)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <SimpleCode>scalekit.dir.user.delete</SimpleCode> | Automated User Deprovisioning  | Triggered when a user is removed from the directory. <br/><br />Also triggered when a user's status is marked as `inactive` in the directory or if the user is removed from all groups assigned to this application.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| <SimpleCode>scalekit.dir.user.update</SimpleCode> | Automated User Role Assignment | To implement automated role assignment, you must enable the "Group Based Access Control" setting in the Scalekit Dashboard and configure all the available roles in your application. <br /><br />As part of your customer's Directory Sync configuration, your customers would configure the mapping between the Groups in their Directory Provider and the Roles in your application. <br /><br />Scalekit will automatically listen to the changes of user and group assignment in your customer's Directory Provider and based on your customer's configuration, we will update the `roles` attribute of the user. You can use the `scalekit.dir.user.update` webhook to listen for changes in the directory and update the user's roles in your application |

## 3. (Optional) Fetch Directory Users via API

### List Directory Users

### Fetch Directory User by ID

## Next Steps

After following the steps above, you have successfully implemented Directory Sync in your application. Next, you can configure the Directory Sync for your customers and test the integration.

If you would like to enable automated role assignment for the Directory Users based on their group memberships, you can follow the [Group Based Access Control (GBAC) Quickstart Guide](/dir-sync/gbac).
