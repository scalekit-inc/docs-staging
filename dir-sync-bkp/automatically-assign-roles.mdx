# Automatic Role Assignment

<Subtitle>
    Assing roles to users (in your app) based on their group memberships in their directory.
</Subtitle>

Manually assigning roles to users in your app (e.g., viewer, member, editor,
admin) can be time-consuming for administrators, especially in large enterprises
where access requirements change frequently. Scalekit allows administrators to
set up workflows that automatically inform your app about the roles to assign to
users.

## Introduction

A popular approach for automating role assignment is to create groups in the
directory provider. Each group lists the users that should have a specific role
in your app. For example, an administrator might create a "GitHub Maintainers"
group to grant "maintainer" access to the GitHub app for certain employees.

By leveraging Scalekit's events, your app can be informed about these groups and
their members, enabling you to automatically assign the appropriate roles to
users.

## Enabling Group-Based Role Assignment

To enable administrators to map groups to roles in your app:

1. Go to the Scalekit Dashboard
2. Select Configuration > "Roles"
3. Toggle "Group Based Role Assignment"
4. Create your app's roles

<figure className='width-75'>
  ![How Scalekit works](@site/docs/dir-sync/assets/automatically-assign-roles-3.png)
  <figcaption>Adding roles in Scalekit dashboard.</figcaption>
</figure>

The first role you create in your app becomes the default role automatically.
This means users who don't belong to any specific group will be assigned this
role upon account creation. To change the default role, navigate to the role
settings, click the "..." menu next to the desired role, select "Edit," and
toggle the "Set as default role" option.

:::tip

Choose clear Display Names and Descriptions for your roles to help
administrators understand the access levels in the Admin Portal.

:::

## Creating Webhook Endpoint

To assign roles based on group membership, your app needs to be informed about
groups and their users. Here's an example webhook endpoint using Next.js:

<CodeWithHeader title="Webhook Endpoint">

<Tabs groupId="tech-stack" queryString>
<TabItem value="nextjs" label="Next.js">

```javascript showLineNumbers
import { NextRequest, NextResponse } from 'next/server';

/**
 * Webhook Endpoint: /api/webhook/role-assignment
 * app/api
 * └── webhook
 *     └── role-assignment
 *         └── route.ts
 */

export async function POST(req: NextRequest) {
  const event = await req.json();
  const { email, name } = event.data;
  await assignRole(roleName, email);
  return NextResponse.json({ message: "Role assigned" }, { status: 201 });
}
```

</TabItem>
</Tabs>
</CodeWithHeader>

Register this webhook in the Scalekit Dashboard > Webhooks and subscribe to all
group-related events. In this example,
<SimpleCode>https:<span></span>//www<span></span>.hero-saas.app<span></span>/api/webhook/role-assignment</SimpleCode>
is the webhook endpoint.

## Example Event Object

When an administrator creates a group or adds users to a group, Scalekit sends
an event object to your app with the necessary information to assign roles.

<CodeWithHeader title="Group Creation Event">

<JsonViewer src={{
  "data": {
    "directory_id": "dir_38610496391217780",
    "display_name": "Avengers",
    "external_id": null,
    "id": "dirgroup_38862741498233423",
    "organization_id": "org_38609339635728478",
    "raw_attributes": {
      "displayName": "Avengers",
      "members": null
    }
  },
  "environment_id": "env_32080745237316098",
  "id": "evt_38862741515010639",
  "object": "DirectoryGroup",
  "occurred_at": "2024-09-25T02:26:39.036398577Z",
  "organization_id": "org_38609339635728478",
  "spec_version": "1",
  "type": "scalekit.dir.group.create"
  }} />

</CodeWithHeader>

<CodeWithHeader title="User Addition to Group Event">

<JsonViewer src={{
  "data": {
    "directory_id": "dir_38610496391217780",
    "display_name": "Avengers",
    "external_id": null,
    "id": "dirgroup_38862741498233423",
    "organization_id": "org_38609339635728478",
    "raw_attributes": {
      "displayName": "Avengers",
      "members": [
        {
          "display": "testuser2@gmail.com",
          "value": "diruser_38864946578129487"
        }
      ]
    }
  },
  "environment_id": "env_32080745237316098",
  "id": "evt_38864948910162368",
  "object": "DirectoryGroup",
  "occurred_at": "2024-09-25T02:48:34.745030921Z",
  "organization_id": "org_38609339635728478",
  "spec_version": "1",
  "type": "scalekit.dir.group.update"
}} />

</CodeWithHeader>

The event data is contained within the data property, while other information
about the organization and event type is present at the same level as data in
the JSON object.

Group-based role assignment offers several benefits:

- Easy setup for your customers
- Flexible role mapping
- No need for workarounds
- Automatic, realtime role assignment based on events from directory provider

By leveraging Scalekit's group-based role assignment, you can streamline access
management for your enterprise customers and ensure that user roles stay
up-to-date with their directory provider. For more information about event
objects, refer to the [Events Reference documentation](/apis#tag/Webhooks).
